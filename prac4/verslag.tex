\documentclass{article}

\usepackage[dutch]{babel}
\usepackage{epsfig}
\usepackage{verbatim}
\usepackage{moreverb}
\usepackage{float}
\usepackage{graphicx}
\usepackage{framed}
\usepackage{chngcntr}
\usepackage{enumitem}
\usepackage{verbdef}
\usepackage{mathtools}
\usepackage{url} 
\usepackage[font=bf]{caption}
\usepackage{amsmath}

\author{Peter van Dijk \& Elizabeth Schermerhorn}
\date{\today}
\title{Lokalisatie met Arduino$`$s op basis van vier bakens}
\begin{document}
\maketitle
\newpage
\tableofcontents
\clearpage
\section{Inleiding}
Dit is het verslag voor de opdracht 'Lokalisatie' van het vak Networked Smart Systems. Voor deze opdracht moest er een lokalisatiealgoritme worden ontwikkeld waarmee binnen een vak van 5 bij 5 meter de positie zo nauwkeurig mogelijk proberen te bepalen. Hierbij wordt gebruik gemaakt van ultrasone signalen vanuit vaste referentiepunten op de hoeken van dit vak. De locatie van een meetinstrument kan van belang zijn bij het verrichtingen van metingen, bijvoorbeeld bij een branddetector in een bos. \\
\\
In dit paper zal het door ons ge\"{i}mplementeerde lokalisatiealgoritme besproken worden. Er zal eerst een afweging worden gemaakt tussen bestaande algoritmen. Daarna zal de gebruikte hardware en software voor de lokalisatie besproken worden. Vervolgens wordt er uit deze algoritmen het algoritme gekozen dat het beste aansluit op deze hardware en software en de implementatie hiervan uitgelegd worden. Daaropvolgend zullen de testopstelling en de resultaten worden uitgelicht. Ten slotte zal hieruit een conclusie worden getrokken en zullen er aanbevelingen voor vervolgonderzoek gedaan worden.


\section{Probleemstelling}
Aan de hand van vier bakens die in een 5 bij 5 meter veld geplaatst worden, moet de positie van de ontvanger bepaald worden. De onderzoeksvraag die hier centraal staat: \textit{``Is het mogelijk om met een afwijking kleiner dan 5 procent de positie van de ontvanger in een 5 bij 5 meter veld te bepalen?"}
De verwachte uitkomst van dit onderzoek is dat het eindproduct in staat is om met een nauwkeurigheid van 25 centimeter (5 procent) de positie te bepalen binnen het 5 bij 5 meter veld. \\
\\
Een limitatie bij deze positiebepaling is onder andere de gebruikte hardware. Er wordt gebruik gemaakt van een Arduino Uno, een computer met beperkte rekenkracht en beperkt werkgeheugen.\cite{uno} Verwachte obstakels hierdoor zijn bit overflows en het beperkte aantal variabelen in de code (in verband met het beperkte werkgeheugen). De overflow wordt als probleem verwacht omdat de Arduino geen grote getallen kan representeren en er waarschijnlijk met grote getallen gerekend moet gaan worden. Een voorbeeld hiervan is bijvoorbeeld de halvering van het bereik van getallen. Zo is een \texttt{long} geen 64, maar 32 bits.\cite{long} Een ander verwacht obstakel is de snelheid van het geluidsignaal dat de bakens zullen gaan uitzenden, omdat de geluidssnelheid varieert naarmate de temperatuur en luchtvochtigheid veranderen. Dit zou gevolgen kunnen hebben voor de te bepalen positie.  


\section{Gerelateerd werk}
Op dit gebied is er al veel onderzoek verricht. Hierdoor is er veel werk wat gebruikt kan worden bij het onderzoek. Er zullen twee papers worden bekeken waarin globale positie systemen (GPS) beschreven worden. In de twee papers worden er trilateratiealgoritmen gepresenteerd waarmee de exacte locatie bepaald kan worden op twee verschillende manieren. In \textit{A New Location Technique for the Active Office} worden twee manieren beschreven \cite{ward97}, namelijk:
\begin{itemize}
	\item Active badges
	\item ParcTab
\end{itemize}
Active Badges is gebaseerd op het periodiek verzenden van informatie naar iedereen. Door bijvoorbeeld een gebouw heen zijn er overal sensoren geplaatst die luisteren naar berichten die worden verstuurd door badges. Door vast te stellen welke sensoren het signaal van welke badge hebben ontvangen is het mogelijk een grove schatting te geven van de locatie van de badge.\\
\\
ParcTab is een zakcomputer die gebruik maakt van een netwerk dat communiceert via infrarood signalen. Wat betreft de lokalisatie lijkt deze heel veel op de badges die hiervoor staan beschreven. Er worden berichten verstuurd en afhankelijk van welke sensor deze ontvangen wordt de locatie bepaald. Een groot verschil is dat de ParcTab is bedoeld voor intensiever gebruik dan alleen het berekenen van de locatie. \\
\\
In het algoritme in het hoofdstuk \textit{Localization and positioning} van \textit{Protocols and Architectures for Wireless Sensor Networks} wordt er gebruik gemaakt van bakens die een signaal uitzenden \cite{h9}. Met behulp van deze bakens kan op twee manieren een positie worden berekend: met \emph{triangulatie} (Figuur \ref{triangulatie}) en \emph{trilateratie} (Figuur \ref{trilateratie}). Triangulatie maakt gebruik van de invalshoek om de positie te berekenen. Hierbij moeten de hoeken tot tenminste twee bakens en de afstand tussen de bakens bekend zijn. Trilateratie gebruikt de afstand tot de bakens om de positie te bepalen. Voor dit algoritme is het van belang dat er minimaal tot drie bakens de afstand bekend is. Wanneer de afstand tot drie bakens bekend is kan met een simpele matrixmultiplicatie de positie berekend worden. Dit is het algoritme dat ook is gebruikt in de in dit paper besproken oplossing.
\begin{figure}[h]
\centering\includegraphics[scale=0.75]{trilateratie.png}
\caption{Trilateratie \cite{h9}}
\label{trilateratie}
\end{figure}
\begin{figure}[h]
\centering\includegraphics[scale=0.75]{triangulatie.png}
\caption{Triangulatie \cite{h9}}
\label{triangulatie}
\end{figure}

De opstelling die hier gebruikt wordt zal als basis principe worden gebruikt voor de implementatie beschreven in deze paper. Aangezien in dit experiment ook gebruik wordt gemaakt van bakens die een signaal versturen en een ontvanger die dit ontvangt en op basis van die gegevens de positie bepaald. 

\section{Instellingen}
Om deze hypothesen te toetsen moeten er metingen gedaan worden. Hier zijn verschillende zaken van belang. 
\begin{itemize}
	\item De gebruikte hardware
	\item De gebruikte software
	\item De instellingen/vastgestelde constanten
	\item De onderzoeksopstelling
\end{itemize}
%De gebruikte hardware
\subsection{De hardware}

\subsubsection{Ontvanger}
De Hardware die gebruikt is voor het ontvangen van de signalen is een Arduino UNO en een Nordic nRF24L01 draadloze transceiver in combinatie met een ultrasoonontvanger. In Figuur \ref{voorkant} en \ref{achterkant} staat de gebruikte ontvanger vanuit twee posities bekeken.
\begin{figure}[h]
\centering\includegraphics[scale=0.06]{voorkant.jpg}
\caption{De ontvanger (voorkant)}
\label{voorkant}
\end{figure}
\begin{figure}[h]
\centering\includegraphics[scale=0.06]{achterkant.jpg}
\caption{De ontvanger (achterkant)}
\label{achterkant}
\end{figure}

\subsubsection{zender}
Als zender is er gebruik gemaakt van vier bakens die een ultrasoon geluid uitzenden. Het signaal van deze bakens wordt verstuurd in de richting waarin ze wijzen. Deze bakens bevatten hardware die vergelijkbaar is met die van de ontvanger, met als grote verschil dat er in plaats van een ultrasoonontvanger een ultrasoonzender is gebruikt.

\subsection{De software}
Om de RF24 radio aan te sturen wordt gebruik gemaakt van de opensourcesoftwarebibliotheek voor de Arduino \cite{rf24}. Met deze software kan de radio aangestuurd worden en kunnen pakketjes worden verzonden en ontvangen. De radio luistert en verstuurt pakketten over een bepaald frequentiekanaal. Het is van belang dat de radio's hetzelfde frequentiekanaal gebruiken, zodat ze met elkaar kunnen communiceren. De kanalen hebben een nummer van 0 tot en met 125. De gebruikte instellingen zijn als volgt:
\begin{itemize}
	\item Frequentiekanaal: 76 
	\item Automatisch herzenden: uit
	\item Transmissiesnelheid: 2 Mbps
	\item Adres pipe: 0xdeadbeefa1
	\item Payload-grootte: 1 byte
\end{itemize}
De ultrasoonontvanger gebruikt de volgende instellingen:
\begin{itemize}
	\item 40 kHz signaal: uit
	\item Versterking: 50x
\end{itemize}
Om de tests te kunnen uitvoeren is er gebruik gemaakt van vier bakens die met een bepaald patroon informatie verzenden. In Figuur \ref{uitzenden_bakens} is schematisch weergegeven hoe de signaalverzending werkt. In het schema zijn vier dezelfde iteraties te zien. Omdat er gebruik wordt gemaakt van vier bakens staan er vier berichten in het schema weergegeven. 
\begin{figure}[h]
\centering\includegraphics[]{berichten_bakens.png}
\caption{Het signaal van de bakens}
\label{uitzenden_bakens}
\end{figure}

\section{Het algoritme}
Het algoritme dat ge\"{i}mplementeerd is, bestaat uit twee verschillende onderdelen. Het eerste deel bestaat uit het berekenen van de afstand tot de bakens en het tweede deel uit de berekening van de positie. Deze twee onderdelen zullen apart besproken worden voor de overzichtelijkheid.
	
\subsection{Afstand bepalen tot aan de bakens}
Zoals te zien is in Figuur \ref{uitzenden_bakens} wordt er eerst een radiosignaal verstuurd, gevolgd door een ultrasoon signaal. De bakens gebruiken een master-slave opstelling, waarbij de master aangeeft wanneer elke slave mag sturen. Als eerste wordt er door de master-baken een radio uitzending uitgevoerd met als bericht het ID van de baken die vervolgens mag zenden. Omdat dit een radiosignaal is gaat dit met de snelheid van het licht, hierdoor is het tijdsverschil tussen de verschillende nodes die het op verschillende momenten ontvangen verwaarloosbaar. Op het moment dat het radiosignaal ontvangen wordt, begint de desbetreffende baken direct met het zenden van een ultrasoon geluid. Er is bekend dat dit meteen gebeurt, dus door bij te houden hoeveel tijd verstrijkt tussen het ontvangen van het radiosignaal en het ontvangen van het ultrasoon geluid kan er een schatting gemaakt worden van de afstand tussen baken en ontvanger door de geluidssnelheid te gebruiken. Deze berekening ziet er als volgt uit:\\
\\
	\indent$ d_b = (T_u- T_r) * g $\\
	\\
	Met:\\
	\\
	\indent$ d_b$: afstand tot baken\\
	\indent$T_u$: tijd ontvangen ultrasoon geluid\\
	\indent$T_r$: tijd ontvangen radio\\
	\indent$g$: geluidssnelheid\\
\\
Het is van belang om een juiste geluidssnelheid te kiezen bij de omgeving waarin het systeem staat, de afwijkingen kunnen groot zijn. Dit proces van luisteren en berekenen herhaalt zich oneindig lang zodat wanneer de node in beweging is er nog steeds een correcte locatie berekend kan worden. 
	
\subsection{Trilateratie}
Nu van alle vier de bakens bekend is wat hun afstand is tot de node kan door middel van matrixberekeningen de positie worden bepaald. Hierbij is er gebruik gemaakt van [iets]. Afstanden zijn gegeven in centimeter, tevens zijn co\"ordinaten weergegeven in centimeters afstand tot het nulpunt.
De volgende berekening is gebruikt bij het berekenen van de locatie: \\
\\
\indent$2*\begin{bmatrix}
       x_3 - x_1 & y_3 - y_1 \\
       x_3 - x_2 & y_3 - y_2 \\          
                
     \end{bmatrix}
     \begin{bmatrix}
       x_u \\          
       y_u \\         
     \end{bmatrix}
=\begin{bmatrix}
       (r_1^2 - r_3^2) - (x_1^2 - x_3^2) - (y_1^2 - y_3^2) \\
       (r_2^2 - r_3^2) - (x_2^2 - x_3^2) - (y_2^2 - y_3^2) \\
     \end{bmatrix}$ \\
 \\
Met: \\
\\
\indent$x_u$: de te berekenen x-co\"{o}rdinaat van de Arduino.\\
\indent$y_u$: de te berekenen y-co\"{o}rdinaat van de Arduino.\\
\indent$x_i$: het x-co\"{o}rdinaat van baken $i$.\\
\indent$y_i$: het y-co\"{o}rdinaat van baken $i$.\\
\indent$r_i$: de afstand van de Arduino tot aan baken $i$.\\
\\
Deze matrixmultiplicatie is om te schrijven naar de volgende formules, waarmee de x- en y-co\"ordinaten van de ontvanger te berekenen zijn: \\
\\
\indent$c_1 = (((r_1*r_1)-(r_3*r_3))-((x_1*x_1)-(x_3*x_3))-((y_1*y_1)-(y_3*y_3)))/2 $\\
\\
\indent$c_2 = (((r_2*r_2)-(r_3*r_3))-((x_2*x_2)-(x_3*x_3))-((y_2*y_2)-(y_3*y_3)))/2 $\\
\\
\indent$n =(-((y_3-y_1)*10000)/(x_3-x_1)) $\\
\\
\indent$m = ((c_1*10000)/(x_3-x_1)) $\\
\\
\indent$y_u = ((c_2*10000) - m*(x_3-x_2))/(n*(x_3-x_2) + (10000*(y_3-y_2))) $\\
\\
\indent$x_u = ((n*y)+m)/10000 $\\
\\
Wat opvalt aan deze berekening is dat er een aantal maal $10.000$ in staat. Deze factor is ge\"introduceerd om te voorkomen dat afkapping van getallen zorgt voor foute resultaten. Als deze factor niet gebruikt zou worden dan zouden tussenberekeningen een getal kleiner dan $1$ kunnen opleveren, wat afgekapt wordt tot $0$.  Hiermee doorrekenen levert incorrecte resultaten op. De factor wordt aan het einde weer weggedeeld, om het gewenste resultaat te verkrijgen. Een alternatief voor deze oplossing is het gebruik van decimale getallen, maar het rekenen hiermee is erg langzaam, daarom is daar niet voor gekozen.\\
\\
Doordat de afstand tot aan de bakens elke 400 milliseconden opnieuw wordt berekend geldt dit ook voor de x- en y-co\"{o}rdinaten. Voor elke vier nieuwe afstandsmetingen worden de x- en y-co\"ordinaten opnieuw berekend. Het algoritme maakt gebruik van alle vier de bakens en niet slechts drie voor de positiebepaling. Dit wordt gedaan als volgt. Voor elke combinatie van drie bakens wordt met behulp van de afstanden tot deze bakens met behulp van het hiervoor genoemde algoritme een set van co\"ordinaten berekend. Vervolgens wordt het gemiddelde genomen van de berekende sets co\"ordinaten. Dit zorgt er voor dat er voor kleine afwijkingen in afstandsberekening tot bakens gecompenseerd kan worden.

\section{Testopstelling en metingen}
Om de implementatie te testen is er gebruik gemaakt van een testopstelling zoals die in Figuur \ref{Meetopstelling} staat weergegeven.
\begin{figure}[h] 
\centering\includegraphics[scale=0.5]{Meetopstelling.png}
\caption{Meetopstelling}
\label{Meetopstelling}
\end{figure}
De unisoonontvangers waarmee de signalen van de bakens worden ontvangen werden op een afstand groter dan vijf meter zeer onnauwkeurig dus is ervoor gekozen om binnen een veld van vijf bij vijf meter te werken. In het schema staan de vier bakens aangegeven met de oranje stippen samen met hun co\"{o}rdinaten. Met de roze stippen worden de testlocaties bedoeld waarop is getest. De bakens die zijn gebruikt versturen alleen signalen in de richting waarin ze wijzen. Hierdoor is het niet mogelijk correcte gegevens te verkrijgen wanneer er vanachter de bakens wordt gemeten. \\
\\
Tijdens het testen wordt de ontvanger op een bepaald co\"{o}rdinaat geplaatst. Het is belangrijk dat deze locatie precies is, anders ontstaat er een afwijking tussen de meetresultaten en de verwachte waarde. 
Het is van belang bij het testen dat er gebruik wordt gemaakt van een "schoon" grid. Dit houdt in, geen obstakels die de metingen zouden kunnen verstoren. Alle tests zijn "schoon"  bepaald. 
Op de volgende locaties zijn de volgende tests uitgevoerd:\\
\\
\indent Test 1: De Arduino wordt op het co\"{o}rdinaat (290, 434) geplaatst. \\
\indent Test 2: De Arduino wordt op het co\"{o}rdinaat (60, 155) geplaatst. \\
\indent Test 3: De Arduino wordt op het co\"{o}rdinaat (72, 377) geplaatst. \\
\\
Verwacht wordt dat de metingen zeer nauwkeurig zullen zijn met een afwijking kleiner dan tien centimeter. 
In Appendix \ref{Meetresultaten} staan alle meetresultaten van de drie tests verwerkt. In de tabellen staat de laatste waarde voor het gemiddelde dat werd berekend door de Arduino. de overige waarden zijn 25 gemeten waarden op die positie. Te zien is dat de metingen niet hetzelfde zijn, ze fluctueren binnen een interval. Een paar redenen hiervoor zijn: 
\begin{itemize}
	\item De ontvanger is bewogen tijdens de meting.
	\item De geluidssnelheid is erg belangrijk voor de berekening en is niet correct afgestemd op de temperatuur en luchtvochtigheid van de ruimte. 
	\item De ultrasoonontvanger ontvangt echo's die weerkaatsen op objecten. Deze foutieve metingen worden meegenomen in de berekening waardoor de waarde niet meer klopt. 
\end{itemize}

\section{Conclusie}
De onderzoeksvraag die aan het begin gesteld werd: \textit{"Een algoritme opstellen waarmee de positie bepaald kan worden met een afwijking van minder dan tien centimeter."} Met dit experiment is het gelukt een lokalisatiealgoritme te ontwerpen en te implementeren met een afwijking kleiner dan tien centimeter. Uit de onderzoeksresultaten die weergegeven staan in Appendix B kan dit geconcludeerd worden. In Appendix B staat in de onderste tabel van elke grafiek de gemiddelde afwijking in centimeters. Voor bovenstaande hypothese geldt wel dat de ontvanger zich v\'{o}\'{o}r de bakens moet bevinden en binnen een veld van vijf bij vijf meter. Anders kan er niet gegarandeerd worden dat de afwijking kleiner dan tien centimeter is. 

\subsection{Aanbevelingen} 
 Voor een vervolgonderzoek zou er naar de volgend punten gekeken kunnen worden.
 \begin{itemize}
 	\item de overflow die ontstaat met het rekenen met integers, op het moment dat de Arduino verder staat dan zes meter bij de bakens vandaan ontstaat er overflow.
 	\item betere bakens en ontvangers, de signalen worden minder na 6 meter
 	\item een algoritme ontwerpen wat beter tegen verstoringen in het veld kan. 
 \end{itemize}
\newpage

%\section{References}
%\nocite{*} % Even non-cited BibTeX-Entries will be shown.
\bibliographystyle{abbrv}
\bibliography{literature}
\newpage
\appendix
\counterwithin{figure}{section}
\section{Code Trilateration}
    \fontsize{8pt}{8pt}\selectfont
\verbatiminput{./location/location.ino}
    \fontsize{10pt}{12pt}\selectfont
\newpage

\section{Meetresultaten}
\label{Meetresultaten}
\begin{tabular}{ |l|l| }
  \hline
  \multicolumn{2}{|c|}{(290, 434)} \\
  \hline
  x-co\"ordinaat & y-co\"ordinaat \\ \hline
     294 & 434\\ \hline
     296 & 445\\ \hline
     296 & 441\\ \hline
     293 & 434\\ \hline
     295 & 436\\ \hline
     293 & 434\\ \hline
     297 & 439\\ \hline
     294 & 432\\ \hline
     293 & 449\\ \hline
     292 & 449\\ \hline
     292 & 449\\ \hline
     293 & 449\\ \hline
     292 & 439\\ \hline
     294 & 439\\ \hline
     286 & 433\\ \hline
     286 & 433\\ \hline
     292 & 436\\ \hline
     291 & 435\\ \hline
     289 & 429\\ \hline
     295 & 436\\ \hline
     293 & 444\\ \hline
     293 & 435\\ \hline
     294 & 451\\ \hline
     293 & 433\\ \hline
     293 & 433\\ \hline
     288 & 440\\ \hline\hline
     292,9 & 439,1 \\ \hline
\end{tabular}
\begin{tabular}{ |l|l| }
  \hline
  \multicolumn{2}{|c|}{(60, 155)} \\
  \hline
  x-co\"ordinaat & y-co\"ordinaat \\ \hline
     59 & 137\\ \hline
     57 & 147\\ \hline
     58 & 154\\ \hline
     58 & 151\\ \hline
     60 & 157\\ \hline
     60 & 148\\ \hline
     60 & 154\\ \hline
     62 & 147\\ \hline
     63 & 151\\ \hline
     62 & 147\\ \hline
     61 & 137\\ \hline
     60 & 154\\ \hline
     60 & 150\\ \hline
     60 & 152\\ \hline
     59 & 152\\ \hline
     60 & 154\\ \hline
     61 & 151\\ \hline
     60 & 152\\ \hline
     62 & 155\\ \hline
     61 & 152\\ \hline
     61 & 155\\ \hline
     61 & 149\\ \hline
     61 & 155\\ \hline
     61 & 154\\ \hline
     60 & 152\\ \hline
     63 & 156\\ \hline\hline
     60,4  & 151,8 \\ \hline
\end{tabular}
\begin{tabular}{ |l|l| }
  \hline
  \multicolumn{2}{|c|}{(72, 377)} \\
  \hline
  x-co\"ordinaat & y-co\"ordinaat \\ \hline
     75 & 378\\ \hline
     77 & 383\\ \hline
     76 & 382\\ \hline
     76 & 381\\ \hline
     75 & 378\\ \hline
     74 & 374\\ \hline
     74 & 377\\ \hline
     75 & 378\\ \hline
     76 & 382\\ \hline
     77 & 387\\ \hline
     76 & 388\\ \hline
     78 & 382\\ \hline
     74 & 387\\ \hline
     76 & 378\\ \hline
     74 & 382\\ \hline
     76 & 381\\ \hline
     77 & 377\\ \hline
     75 & 382\\ \hline
     77 & 377\\ \hline
     75 & 380\\ \hline
     76 & 374\\ \hline
     73 & 382\\ \hline
     75 & 377\\ \hline
     74 & 376\\ \hline
     77 & 378\\ \hline
     78 & 380\\ \hline\hline
     75,6 & 379,5 \\ \hline 
\end{tabular}
\newline
\begin{tabular}{ |l|p{3,1cm}| }
  \hline
  \multicolumn{2}{|c|}{afwijking(290, 434) in cm} \\
  \hline
  x & 2,9 \\ \hline
  y & 5,1 \\ \hline
  (x,y) & 5,87 \\ \hline
\end{tabular}
\begin{tabular}{ |l|p{3,1cm}| }
  \hline
  \multicolumn{2}{|c|}{afwijking (60, 155) in cm} \\
  \hline
  x & 0,4 \\ \hline
  y & 3,2 \\ \hline
  (x,y) & 3,22 \\ \hline
\end{tabular}
\begin{tabular}{ |l|p{3,1cm}| }
  \hline
  \multicolumn{2}{|c|}{afwijking(72,377) in cm} \\
  \hline
  x & 3,6 \\ \hline
  y & 2,5 \\ \hline
  (x,y) & 4,38 \\ \hline
\end{tabular}

\end{document}